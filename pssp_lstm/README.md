
# Прогнозирование вторичной структуры с использованием длительной кратковременной памяти

Цель этого репозитория - реализовать представленную модель [here](https://arxiv.org/pdf/1412.7828.pdf) чтобы воспроизвести результаты, заявленные в этом документе.
### Описание
> Предсказание вторичной структуры белка по аминокислотной последовательности является классической проблемой биоинформатики. Обычные методы используют нейронные сети прямой связи или SVM в сочетании со скользящим окном, 
но эти модели естественно не обрабатывают последовательные(недискретные) данные. Рекуррентные нейронные сети являются примером использования обратной связи
в нейронных сетях, которые естественно обрабатывают последовательные данные. Мы используем двунаправленную рекуррентную нейронную сеть с длинной
ячейкой краткосрочной памяти для прогнозирования вторичной структуры и оценки с использованием набора данных CB513. Наша модель
включает в себя сети прямой связи между ячейками долгосрочной кратковременной памяти.

# Обзор

- **model.py**: Двунаправленный класс LSTM RNN
- **dataset.py**: Конвейер ввода данных
- **hparams.py**: Указание гиперпараметров для модели
- **metrics.py**: Пользовательская confusion matrix потоков
- **train.py**: Тренировка модели
- **evaluate.py**: Оценивание модели
- **__main__.py**: Драйвер / инструмент командной строки

# User Guide
*Примечание. Предполагается, что все команды bash выполняются из родительского каталога этого модуля.*

## Требования

- Python 3
- [TensorFlow](https://www.tensorflow.org/install/) >= v1.7


## Загрузка и подготовка данных

Набор данных, используемый в этой статье, можно загрузить [here](https://www.princeton.edu/~jzthree/datasets/ICML2014/). Входной поток использует API набора данных TensorFlow, поэтому файлы данных необходимо преобразовать в TFRecords. Предполагается, что вы загрузили файлы .npy.gz в каталог * datadir *, вы можете создать файлы .tfrecords, вызвав:
```
./make_tfrecords -d datadir
```
Это создаст наборы данных обучения, проверки и тестирования. Видеть [make_tfrecords.py](./make_tfrecords.py) для большей информации [MakeTFRecords.ipynb](./MakeTFRecords.ipynb) для пошагового ознакомления с тем, что делает скрипт.

**ВНИМАНИЕ**: Данные numpy и tfrecords будут использовать около 4 ГБ пространства.

## Обучение модели

Предполагая, что наборы данных записей TF были созданы, самый быстрый способ обучить модель - это вызвать
```
python -m pssp_lstm train /path/to/data/dir /path/to/log/dir
```
Это обучит модель, как описано в наборе данных CullPDB. Обучение будет производиться партиями по 64 элемента, пока проверка ошибки не увеличится на 5 шагов проверки. Во время обучения вы должны видеть регулярные сообщения о состоянии: 
```
...
Step: 630, Training Loss: 245.6874, Avg Sec/Step: 1.29
Step: 645, Training Loss: 129.7199, Avg Step/Sec: 0.77
Step: 650, Eval Loss: 132.1941, Eval Accuracy: 0.5192
...
```

В зависимости от вашего оборудования вы можете использовать пакеты разных размеров. Модель и тренировочные гиперпараметры можно настроить в [hparams.py](./pssp_lstm/hparams.py) .

## Визуализация результатов обучения

Если флаг `--logging` пропускается во время обучения, после чего сводные данные сохраняются для ряда статистических данных о тренировке, включая  потерю точности, ухудшение показателей в confusion matrix, гистограммах веса и т. д.

Эти данные можно отобразить [Tensorboard](https://github.com/tensorflow/tensorboard). Если логи сохранены в  `logdir`, вы можете вызвать tensorboard server вызвав
```
tensorboard --logdir logdir
```
По умолчанию данная команда запускает веб-сервер на локальном хосте.

## Оценивание модели

После того, как модель обучена, вы можете сравнить ее с набором тестов CullPDB 513 с помощью следующего вызова:
```
python -m pssp_lstm evaluate /path/to/data/dir /path/to/ckpts/ckpt
```
Здесь вторым аргументом является не каталог, а путь к контрольной точке модели, ранее сохраненной во время обучения. Это будет  `logdir/ckpt/`, где `logdir` был каталог, указанный при обучении, и имеет имена вида `ckpt-3000*`. Будет несколько файлов, которые начинаются таким образом для каждой контрольной точки, и необходим только префикс. Один из примеров оценки модели может выглядеть так
```
python -m pssp_lstm evaluate /home/user/data/ /home/user/models/ckpt/ckpt-3000
```

# Ресурсы


- Набор данных использует данные о белках из [Protein Databank](https://www.wwpdb.org/)
- Метки вторичной структуры назначаются в соответствии со словарем меток вторичной структуры белка [(DSSP)](http://swift.cmbi.ru.nl/gv/dssp/) 

# Доп. ссылки

1. Sixty-five years of the long march in protein secondary structure prediction: the final stretch? Yang, Y., *et al.* [Link](https://academic.oup.com/bib/advance-article/doi/10.1093/bib/bbw129/2769436)
